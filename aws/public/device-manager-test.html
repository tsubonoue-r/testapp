<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeviceManager Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .device-switcher {
            display: flex;
            gap: 8px;
        }

        .device-switcher button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
            min-width: 44px;
        }

        .device-switcher button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .device-switcher button.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .status {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status dt {
            font-weight: 600;
            color: #667eea;
        }

        .status dd {
            margin: 0;
        }

        .visibility-test {
            display: grid;
            gap: 10px;
        }

        .test-item {
            padding: 15px;
            border-radius: 8px;
            background: #f0f0f0;
        }

        .mobile-only {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .tablet-only {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .desktop-only {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        /* Device-specific visibility */
        body[data-device="mobile"] .desktop-only { display: none !important; }
        body[data-device="mobile"] .tablet-only { display: none !important; }
        body[data-device="tablet"] .mobile-only { display: none !important; }
        body[data-device="tablet"] .desktop-only { display: none !important; }
        body[data-device="desktop"] .mobile-only { display: none !important; }
        body[data-device="desktop"] .tablet-only { display: none !important; }

        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #764ba2;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DeviceManager Test</h1>
        <div class="device-switcher">
            <button data-device="mobile" title="ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤º">ğŸ“±</button>
            <button data-device="tablet" title="ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤º">ğŸ“Ÿ</button>
            <button data-device="desktop" title="PCè¡¨ç¤º">ğŸ’»</button>
        </div>
    </div>

    <div class="card">
        <h2>ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºçŠ¶æ…‹</h2>
        <dl class="status">
            <dt>ç¾åœ¨ã®ãƒ‡ãƒã‚¤ã‚¹:</dt>
            <dd id="current-device">-</dd>

            <dt>ç”»é¢ã‚µã‚¤ã‚º:</dt>
            <dd id="screen-size">-</dd>

            <dt>User-Agent:</dt>
            <dd id="user-agent" style="font-size: 12px; word-break: break-all;">-</dd>

            <dt>ã‚¿ãƒƒãƒã‚µãƒãƒ¼ãƒˆ:</dt>
            <dd id="touch-support">-</dd>

            <dt>ãƒ”ã‚¯ã‚»ãƒ«æ¯”:</dt>
            <dd id="pixel-ratio">-</dd>

            <dt>è‡ªå‹•æ¤œå‡ºçµæœ:</dt>
            <dd id="auto-detected">-</dd>

            <dt>ä¿å­˜æ¸ˆã¿è¨­å®š:</dt>
            <dd id="saved-preference">-</dd>
        </dl>
    </div>

    <div class="card">
        <h2>è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ</h2>
        <p>ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ã€å¯¾å¿œã™ã‚‹ãƒœãƒƒã‚¯ã‚¹ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        <div class="visibility-test">
            <div class="test-item mobile-only">
                ğŸ“± <strong>ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</strong> - ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã®æ™‚ã®ã¿è¡¨ç¤º
            </div>
            <div class="test-item tablet-only">
                ğŸ“Ÿ <strong>ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå°‚ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</strong> - ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã®æ™‚ã®ã¿è¡¨ç¤º
            </div>
            <div class="test-item desktop-only">
                ğŸ’» <strong>ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å°‚ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</strong> - PCè¡¨ç¤ºã®æ™‚ã®ã¿è¡¨ç¤º
            </div>
        </div>
    </div>

    <div class="card">
        <h2>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <div class="actions">
            <button class="btn btn-primary" onclick="updateInfo()">çŠ¶æ…‹ã‚’æ›´æ–°</button>
            <button class="btn btn-secondary" onclick="clearPreference()">ä¿å­˜è¨­å®šã‚’ã‚¯ãƒªã‚¢</button>
            <button class="btn btn-secondary" onclick="testResize()">ãƒªã‚µã‚¤ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        </div>
    </div>

    <script>
        /**
         * DeviceManager - Automatic device detection and manual UI switching
         */
        class DeviceManager {
            constructor() {
                this.storageKey = 'preferredDevice';
                this.init();
            }

            detectDevice() {
                const ua = navigator.userAgent;
                const width = window.innerWidth;
                const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                const pixelRatio = window.devicePixelRatio || 1;

                const isMobileUA = /iPhone|iPod|Android.*Mobile/i.test(ua);
                const isTabletUA = /iPad|Android(?!.*Mobile)/i.test(ua);

                if (width < 768) {
                    return 'mobile';
                } else if (width < 1024) {
                    if (isTabletUA || (hasTouch && pixelRatio > 1)) {
                        return 'tablet';
                    }
                    return 'tablet';
                } else {
                    return 'desktop';
                }
            }

            getSavedDevice() {
                try {
                    return localStorage.getItem(this.storageKey);
                } catch (e) {
                    console.warn('LocalStorage not available:', e);
                    return null;
                }
            }

            saveDevice(device) {
                try {
                    localStorage.setItem(this.storageKey, device);
                    console.log('Device preference saved:', device);
                    updateInfo();
                } catch (e) {
                    console.warn('Cannot save to localStorage:', e);
                }
            }

            applyDevice(device) {
                document.body.setAttribute('data-device', device);
                this.updateSwitcherButtons(device);
                console.log('Device applied:', device);
                updateInfo();
            }

            updateSwitcherButtons(device) {
                document.querySelectorAll('.device-switcher button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.device === device);
                });
            }

            init() {
                const savedDevice = this.getSavedDevice();
                const detectedDevice = this.detectDevice();
                const device = savedDevice || detectedDevice;

                this.applyDevice(device);

                document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.device-switcher button').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const selectedDevice = btn.dataset.device;
                            this.saveDevice(selectedDevice);
                            this.applyDevice(selectedDevice);
                        });
                    });

                    updateInfo();
                });

                let resizeTimer;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(() => {
                        if (!this.getSavedDevice()) {
                            const newDevice = this.detectDevice();
                            this.applyDevice(newDevice);
                        }
                        updateInfo();
                    }, 300);
                });
            }
        }

        const deviceManager = new DeviceManager();

        function updateInfo() {
            const currentDevice = document.body.getAttribute('data-device');
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const savedDevice = deviceManager.getSavedDevice();
            const detectedDevice = deviceManager.detectDevice();

            document.getElementById('current-device').textContent = currentDevice || '-';
            document.getElementById('screen-size').textContent = `${window.innerWidth} x ${window.innerHeight}`;
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('touch-support').textContent = hasTouch ? 'Yes' : 'No';
            document.getElementById('pixel-ratio').textContent = window.devicePixelRatio || 1;
            document.getElementById('auto-detected').textContent = detectedDevice;
            document.getElementById('saved-preference').textContent = savedDevice || 'None';
        }

        function clearPreference() {
            try {
                localStorage.removeItem('preferredDevice');
                alert('ä¿å­˜è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚');
                location.reload();
            } catch (e) {
                alert('LocalStorageã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: ' + e.message);
            }
        }

        function testResize() {
            alert('ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¦ã€è‡ªå‹•æ¤œå‡ºã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\n' +
                  'ä¿å­˜æ¸ˆã¿è¨­å®šãŒã‚ã‚‹å ´åˆã¯ã€ãƒªã‚µã‚¤ã‚ºã—ã¦ã‚‚åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã›ã‚“ã€‚\n' +
                  'ä¿å­˜è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚');
        }
    </script>
</body>
</html>
